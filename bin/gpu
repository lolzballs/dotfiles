#!/bin/sh

dank=$(cat /proc/acpi/bbswitch)

if [ "$1" == "on" ]
then
    if [[ $dank == *"OFF"* ]]; then
        echo ON | sudo tee /proc/acpi/bbswitch
    fi
fi

if [ "$1" == "off" ]
then
    gpu rmmod
    if [[ $dank == *"ON"* ]]; then
        echo OFF | sudo tee /proc/acpi/bbswitch
    fi
fi

if [ "$1" == "modprobe" ]
then
    if ! ($(lsmod | grep -q 'nvidia_drm')); then
        sudo modprobe nvidia-drm
    fi
fi

if [ "$1" == "rmmod" ]
then
    if ($(lsmod | grep -q 'nvidia')); then
        sudo rmmod nvidia_drm
        sudo rmmod nvidia_modeset
        sudo rmmod nvidia_uvm
        sudo rmmod nvidia
    fi
fi

if [ "$1" == "status" ]
then
    echo $dank
fi
